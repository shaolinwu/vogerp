<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns2:UIPage xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:ns2="http://bmdp.shaolin.org/datamodel/Page" xmlns="http://bmdp.shaolin.org/datamodel/Common"
	xsi:schemaLocation="">
	<entityName>org.shaolin.vogerp.coupon.page.UserManagement</entityName>
	<systemVersion>0</systemVersion>
	<description>订单下的优惠券信息</description>
	
	<ns2:UIEntity xsi:type="ns2:UIEntityType">
		<ns2:eventHandler functionName="selectOrg">
           <ns2:ops xsi:type="ns2:OpCallAjaxType" name="selectOrg-201508111433">
                <ns2:exp>
                    <ns2:expressionString><![CDATA[
                    import java.util.HashMap;
                    import org.shaolin.uimaster.page.AjaxContext;
                    import org.shaolin.uimaster.page.AjaxActionHelper;
                    import org.shaolin.uimaster.page.ajax.*;
                    import org.shaolin.vogerp.commonmodel.be.*;
                    import org.shaolin.vogerp.commonmodel.dao.CommonModel;
                    import java.util.List;
                    {
                    	String orgId = @page.getComboBox("orgNameUI").getValue();
                    	PersonalInfoImpl personCond = new PersonalInfoImpl();
                    	personCond.setOrgId(Long.valueOf(orgId));
                    	List personInfos = CommonModel.INSTANCE.searchPersonInfo(personCond, null, 0, 0);
                    	if (null != personInfos && personInfos.size() > 0) {
                    		PersonalInfoImpl person = (PersonalInfoImpl) personInfos.get(0);
                    		@page.getLabel("nameUI").setDisplayValue(person.getFirstName());
                    	}
                    	
                        /*Table moduleInfoTable = (Table)@page.getElement("moduleInfoTable");
                        ModuleGroupImpl condition = (ModuleGroupImpl)moduleInfoTable.getConditions().getCondition();
                        condition.setName(@page.getComboBox("allOrgsUI").getValue());
                        
                        moduleInfoTable.refresh();*/
                    }
                    ]]></ns2:expressionString>
                </ns2:exp>
            </ns2:ops>
        </ns2:eventHandler>
	
		<ns2:body UIID="Form" xsi:type="ns2:UIPanelType">
			<ns2:layout xsi:type="ns2:TableLayoutType">
				<ns2:rowHeightWeight>0.0</ns2:rowHeightWeight>
				<ns2:rowHeightWeight>0.0</ns2:rowHeightWeight>
				<ns2:columnWidthWeight>0.0</ns2:columnWidthWeight>
				<ns2:columnWidthWeight>0.0</ns2:columnWidthWeight>
			</ns2:layout>
			<ns2:component xsi:type="ns2:UILabelType" UIID="orgNameUILabel">
		        <ns2:UIStyle>uimaster_leftform_widget</ns2:UIStyle>
		        <ns2:text xsi:type="ns2:ResourceBundlePropertyType">
		          <ns2:bundle>org_shaolin_vogerp_coupon_i18n</ns2:bundle>
		          <ns2:key>org.shaolin.vogerp.coupon.be.UserManagement.orgName</ns2:key>
		        </ns2:text>
		    </ns2:component>
		    <ns2:component xsi:type="ns2:UIComboBoxType" UIID="orgNameUI">
		        <ns2:UIStyle>uimaster_rightform_widget</ns2:UIStyle>
		        <ns2:EventListener xsi:type="ns2:ItemChangeListenerType">
                    <ns2:handler functionName="selectOrg"></ns2:handler>
                </ns2:EventListener>
		    </ns2:component>
		    <ns2:component xsi:type="ns2:UILabelType" UIID="nameUILabel">
		        <ns2:UIStyle>uimaster_leftform_widget</ns2:UIStyle>
		        <ns2:text xsi:type="ns2:ResourceBundlePropertyType">
		          <ns2:bundle>org_shaolin_vogerp_coupon_i18n</ns2:bundle>
		          <ns2:key>org.shaolin.vogerp.coupon.be.UserManagement.name</ns2:key>
		        </ns2:text>
		    </ns2:component>
		    <ns2:component xsi:type="ns2:UILabelType" UIID="nameUI">
		        <ns2:UIStyle>uimaster_rightform_widget</ns2:UIStyle>
		    </ns2:component>
		    <ns2:layoutConstraint>
				<ns2:componentId>orgNameUILabel</ns2:componentId>
				<ns2:constraint xsi:type="ns2:TableLayoutConstraintType" x="0" y="0" align="FULL" cellUIClass="uimaster_leftform_cell"></ns2:constraint>
			</ns2:layoutConstraint>
			<ns2:layoutConstraint>
				<ns2:componentId>orgNameUI</ns2:componentId>
				<ns2:constraint xsi:type="ns2:TableLayoutConstraintType" x="1" y="0" align="FULL" cellUIClass="uimaster_rightform_cell"></ns2:constraint>
			</ns2:layoutConstraint>
			<ns2:layoutConstraint>
				<ns2:componentId>nameUILabel</ns2:componentId>
				<ns2:constraint xsi:type="ns2:TableLayoutConstraintType" x="0" y="1" align="FULL" cellUIClass="uimaster_leftform_cell"></ns2:constraint>
			</ns2:layoutConstraint>
			<ns2:layoutConstraint>
				<ns2:componentId>nameUI</ns2:componentId>
				<ns2:constraint xsi:type="ns2:TableLayoutConstraintType" x="1" y="1" align="FULL" cellUIClass="uimaster_rightform_cell"></ns2:constraint>
			</ns2:layoutConstraint>
		</ns2:body>
	</ns2:UIEntity>
	<ns2:ODMapping>
		<ns2:DataEntity scope="InOut" name="orgIds" category="JavaClass">
			<type entityName="java.util.List"></type>
		</ns2:DataEntity>
		<ns2:DataEntity scope="InOut" name="orgNames" category="JavaClass">
			<type entityName="java.util.List"></type>
		</ns2:DataEntity>
		<ns2:DataEntity scope="InOut" name="personalInfo" category="BusinessEntity">
			<type entityName="org.shaolin.vogerp.commonmodel.be.PersonalInfo"></type>
		</ns2:DataEntity>
		<ns2:ComponentMapping xsi:type="ns2:SimpleComponentMappingType" name="simpleMapping0">
	      <ns2:mappingRule entityName="org.shaolin.uimaster.page.od.rules.UISingleChoice"></ns2:mappingRule>
	      <ns2:UIComponent componentPath="orgNameUI" paramName="UIWidgetType"></ns2:UIComponent>
	      <ns2:DataComponent xsi:type="ns2:ComponentParamType" componentPath="orgIds" paramName="OptionValues"></ns2:DataComponent>
	      <ns2:DataComponent xsi:type="ns2:ComponentParamType" componentPath="orgNames" paramName="OptionDisplayValues"></ns2:DataComponent>
	    </ns2:ComponentMapping>
	</ns2:ODMapping>
	<ns2:in>
		<ns2:serverOperation xsi:type="ns2:ExpressionParamType">
            <ns2:expressionString><![CDATA[
            import java.util.List;
            import org.shaolin.bmdp.runtime.AppContext;
            import org.shaolin.vogerp.commonmodel.be.OrganizationImpl;
            import org.shaolin.vogerp.commonmodel.dao.CommonModel;
            import java.util.ArrayList;
            {
            	$orgIds = new ArrayList();
            	$orgNames = new ArrayList();
            	OrganizationImpl condition = new OrganizationImpl();
            	List orgs = CommonModel.INSTANCE.searchOrganization(condition, null, 0, 0);
            	if (null != orgs && orgs.size() > 0) {
            		for (int i = 0; i < orgs.size(); i++) {
	            		OrganizationImpl org = (OrganizationImpl) orgs.get(i);
	            		$orgIds.add(String.valueOf(org.getId()));
	            		$orgNames.add(org.getName());
            		}
            	}
            	
            	@odContext.executeAllMappings();
            }
            ]]></ns2:expressionString>
        </ns2:serverOperation>
	</ns2:in>
</ns2:UIPage>